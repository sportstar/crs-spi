---
category:
    shop_by_price: true
    products:
        limit: {{theme_settings.categorypage_products_per_page}}
cart: true
---

{{inject "categoryProductsPerPage" theme_settings.categorypage_products_per_page}}
{{inject "categoryId" category.id}}
{{#partial "head"}}
    {{#if pagination.category.previous}}
        <link rel="prev" href="{{pagination.category.previous}}">
    {{/if}}
    {{#if pagination.category.next}}
        <link rel="next" href="{{pagination.category.next}}">
    {{/if}}
{{/partial}}

{{#partial "page"}}

{{> components/common/breadcrumbs breadcrumbs=breadcrumbs}}
{{#if category.image}}
    {{> components/common/responsive-img
        image=category.image
        fallback_size=theme_settings.zoom_size
        lazyload=theme_settings.lazyload_mode
        class="category-header-image"
    }}
{{/if}}
{{#unless theme_settings.hide_category_page_heading }}
    <h1 class="page-heading">{{category.name}}</h1>
    {{{region name="category_below_header"}}}
{{/unless}}
{{{category.description}}}

<div class="page" id="special-item">
   <!--  {{#if category.faceted_search_enabled}}
        <aside class="page-sidebar" id="faceted-search-container">
            {{> components/category/sidebar}}
        </aside>
    {{else if category.subcategories}}
        <aside class="page-sidebar" id="faceted-search-container">
            {{> components/category/sidebar}}
        </aside>
    {{else if category.shop_by_price}}
        {{#if theme_settings.shop_by_price_visibility}}
             <aside class="page-sidebar" id="faceted-search-container">
                {{> components/category/sidebar}}
            </aside>
        {{/if}}
    {{/if}} -->

    <div class="page-content" id="product-listing-container">
        {{> components/category/product-listing}}
        {{{region name="category_below_content"}}}

    </div>
</div>

{{/partial}}
{{> layout/base}}


{inject "productIds" (pluck category.products "id")}}
{{inject "productNames" (pluck category.products "name")}}
{{inject "productImages" (pluck category.products "image")}}
{{inject "productPrices" (pluck category.products "price")}}

<script>

const addSpecialItem = document.querySelector('#addItems');
const deleteItem = document.querySelector('#deleteItems');
const cartInfoDiv = document.querySelector('#cartInfo');
const imageSrc = document.querySelector('.card-img-container img');
let quantity = 0;

init();


function init() {
    fetch('/api/storefront/cart?include=lineItems.digitalItems.options,lineItems.physicalItems.options', {
  credentials: 'same-origin'}
     )
  .then(function(response) {
    return response.json();
  })
  .then(function(myJson) {
    if(myJson.length === 0) {
        cartInfoDiv.innerHTML = `<h3>Item in cart: ${quantity}</h3>`;
        deleteItem.style.display = "none";
        return;
    }
  //  console.log('cart info', myJson);
    deleteItem.style.display = "block";
     cartInfo = myJson;
     quantity = myJson[0].lineItems.physicalItems[0].quantity;
    cartInfoDiv.innerHTML = `<h3>Item in cart: ${quantity}</h3>`;
  })
  .catch(error => console.log(error));
 
}


//** Click Handler **//
addSpecialItem.addEventListener('click', () => {
  addCart();
  showMessage('Item have been added to cart');
});

deleteItem.addEventListener('click', () => {
    console.log('cart info delete', cartInfo);
    deleteCartItem(`/api/storefront/carts/`, cartInfo[0].id, cartInfo[0].lineItems.physicalItems[0].id)
     .then(data => console.log('deleted', data))
     .catch(error => console.log('error', error));
     showMessage('All items have been deleted')
     location.reload();
})

imageSrc.addEventListener('mouseover', () => {
  imageSrc.setAttribute('srcset', 'https://cdn11.bigcommerce.com/s-orospfyfon/products/112/images/376/th__27277.1621237401.220.290.jpg');
});

imageSrc.addEventListener('mouseout', () => {
  imageSrc.setAttribute('srcset', 'https://cdn11.bigcommerce.com/s-orospfyfon/products/112/images/377/340147bccd56cc3e947b629b6a774391__21045.1620850742.220.290.png');
});




function addCart() {
     var xhttp = new XMLHttpRequest();
     xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
       init();
    
    }
  };
  xhttp.open("POST", `http://${window.location.host}/cart.php?action=add&product_id=112`, true);
  xhttp.send();
}


function deleteCartItem(url, cartId, itemId) {
   return fetch(url + cartId + `/items/` + itemId, {
       method: "DELETE",
       credentials: "same-origin",
       headers: {
           "Content-Type": "application/json",}
})
.then(response => response.json()).then(deleted => location.reload());
};

function showMessage(msg) {
    let str = `<h4>${msg}</h4>`;
    document.querySelector('.message').classList.add('show');
    document.querySelector('.message').innerHTML = str;
}


</script>
<style>

.special-items{
    text-align:center;
}

.spi-btn {
    color: white;
    justify-content: center;
    display: block;
    margin: auto;
    font-size: 1.5rem;
    font-weight: 400;

    background-color: #394a9c;
    padding: 20px 30px;
}
}

.message.show {
    text-align: center;
    vertical-align: middle;
    max-width: 80%;
    display: block;
    margin: auto;
}

.message.show h4 {
        color: #ca3861;
    font-weight: 600;
    font-size: 2rem;
    letter-spacing: 6px;
    padding-bottom: 10px;
    opacity:0;
    animation: fade 5s linear;
}

@keyframes fade {
    0% {
        opacity: 1;
    }
    50% {
        opacity: .5;
    }
    100% {
        opacity: 0;
    }
}

</style>